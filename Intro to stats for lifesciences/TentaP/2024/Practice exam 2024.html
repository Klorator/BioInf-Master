<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="BJBTE-0006-WHR">

<title>Practice exam 2024</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Practice exam 2024_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practice exam 2024_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Practice exam 2024_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Practice exam 2024_files/libs/quarto-html/popper.min.js"></script>
<script src="Practice exam 2024_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practice exam 2024_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practice exam 2024_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practice exam 2024_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practice exam 2024_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practice exam 2024_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practice exam 2024_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practice exam 2024</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>BJBTE-0006-WHR </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1)</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>larvae <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">spring =</span> <span class="fu">c</span>(<span class="st">"dark brown"</span> <span class="ot">=</span> <span class="dv">17</span>, <span class="st">"light brown"</span> <span class="ot">=</span> <span class="dv">34</span>, <span class="st">"green"</span> <span class="ot">=</span> <span class="dv">53</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">summer =</span> <span class="fu">c</span>(<span class="dv">113</span>, <span class="dv">113</span>, <span class="dv">73</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tbl-cap="Number of larvae (*Pararge xiphia*) found.">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Number of larvae (<em>Pararge xiphia</em>) found.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">dark brown</th>
<th style="text-align: right;">light brown</th>
<th style="text-align: right;">green</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">spring</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="even">
<td style="text-align: left;">summer</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">73</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="a" class="level3">
<h3 class="anchored" data-anchor-id="a">a)</h3>
<p>Because we have counts for categories, a chi-square test would be appropriate. The null hypothesis is that there is no difference in frequency between any groups.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  larvae
X-squared = 28.945, df = 2, p-value = 5.185e-07</code></pre>
</div>
</div>
</section>
<section id="b" class="level3">
<h3 class="anchored" data-anchor-id="b">b)</h3>
<p>The chi-square test on the full dataset indicated that there is a difference between at least one of the groups (X<sup>2</sup> = 28.95, df = 2, p = 5.19e-10).</p>
</section>
<section id="c" class="level3">
<h3 class="anchored" data-anchor-id="c">c)</h3>
<p>There is a difference between the three color-morphs where the brown larvae are fewer than expected in spring and green larvae are more abundant. In summer the relationship is reversed with more brown and fewer green larvae. (As seen by comparing observed and expected counts.) This correlates with the original hypothesis about camouflage, although the counts are overall much lower in spring which may be cause for concern.</p>
</section>
<section id="d" class="level3">
<h3 class="anchored" data-anchor-id="d">d)</h3>
<p>Additional tests could be to perform post-hoc pairwise chi-square tests to determine between which groups the difference is. Note that the p-values need to be adjusted.</p>
</section>
<section id="e" class="level3">
<h3 class="anchored" data-anchor-id="e">e)</h3>
<p>Improvements to the experimental design could be collecting data over several years to account for seasonal variation/cycles. Additional variables can be measured, such as temperature, percipitation, preadators. The experiment could also be performed at different geographical locations. Such information gives information on variable factors in the uncontrolled environmnet and may help explain variation or highlight trends.</p>
</section>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2)</h2>
<section id="data-1" class="level3">
<h3 class="anchored" data-anchor-id="data-1">Data</h3>
<div class="cell" data-tbl-cap="Summary of spruce growth by treatment and species.">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Summary of spruce growth by treatment and species.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">treatment</th>
<th style="text-align: left;">Species</th>
<th style="text-align: right;">growth_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ctrl</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">38.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">ctrl</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">13.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ctrl</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">82.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ctrl</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">20.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fertilizer</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">24.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">fertilizer</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fertilizer</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">51.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">fertilizer</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">22.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="a-1" class="level3">
<h3 class="anchored" data-anchor-id="a-1">a)</h3>
<p>For investigating the difference in growth based on two factors, a two-way ANOVA is appropriate. The main null hypothesis is that there is no difference in growth based on the treatment. Addidtional null hypothesies are that there is no difference in growth based on species nor the interaction between treatment and species.</p>
</section>
<section id="b-1" class="level3">
<h3 class="anchored" data-anchor-id="b-1">b)</h3>
<p>Inspecting the residuals indicate that they look ok enough because ANOVA is a pretty robust method. The within groups variation is not compleately even across the dataset (left-hand residual plots) but there don’t seem to be any problematic outliers (right-hand plots).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practice-exam-2024_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Formula: <code>growth ~ treatment * Species</code>.</figcaption>
</figure>
</div>
</div>
</div>
<p>We could attempt a log<sub>10</sub> transformation to make the spread of residuals a little more homogenous. This improves the model slightly but also makes the results harder to interpret biologically so I don’t consider the improvement worth the transformation.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practice-exam-2024_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Formula: <code>log10(growth) ~ treatment * Species</code>.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="c-1" class="level3">
<h3 class="anchored" data-anchor-id="c-1">c)</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practice-exam-2024_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Distribution of data by species and treatment.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="d-1" class="level3">
<h3 class="anchored" data-anchor-id="d-1">d)</h3>
<p>The ANOVA indicates that there is a difference based on treatment (F = 20.78, df = 1, p = 0.0003), species (F = 83.3, df = 3, p = 5.58e-10), and their interaction (F = 6.8, df = 3, p = 0.0036).</p>
<p>To investigate between which groups the difference lies, I perform post-hoc analysis using <code>TukeyHSD</code>. This indicates a difference based on treatment (as expected since there are only two groups), as well as a difference between all pairings of species except D vs A. Species D vs B is questionable as the adjusted p-value is very close to 0.05 (p adj = 0.048).</p>
<p>I will omit a detailed interpretation of the interaction as it is verbose and not the main focus of the study. There is no difference due to the interaction within species A nor B.</p>
</section>
<section id="e-1" class="level3">
<h3 class="anchored" data-anchor-id="e-1">e)</h3>
<p>My conclusion is that fertilizer should not be used as for all occasions where there is a difference between means in growth the fertilization treatment yielded less growth compared to the control.</p>
</section>
</section>
<section id="question-3" class="level2">
<h2 class="anchored" data-anchor-id="question-3">Question 3)</h2>
<section id="a-2" class="level3">
<h3 class="anchored" data-anchor-id="a-2">a)</h3>
<ul>
<li>F = 110.7 / (2440.2 / 2111) = 95.77</li>
<li>P = pf(95.77, 1, 2111) = 3.79e-22</li>
<li>R<sup>2</sup> = 110.7 / (110.7 + 2440.2) = 0.043</li>
</ul>
</section>
<section id="b-2" class="level3">
<h3 class="anchored" data-anchor-id="b-2">b)</h3>
<p>While the p-value indicates that sun exposure has an effect, the R<sup>2</sup>-value is very low and indicates no true correlation. As a whole I would, therefore, not draw the conclusion that sun-bathing plays a significant role in developing skin cancer compared to other possible factors. The “self-reported” aspect is a difficult variable to use as basis for extrapolating to the population due to the uncertainty in accuracy.</p>
</section>
<section id="c-2" class="level3">
<h3 class="anchored" data-anchor-id="c-2">c)</h3>
<p>I am assuming a regression was performed to produce what is given (R<sup>2</sup>), which is possible given that the scale for skin-cell changes is treated as a continous variable. This is possible depending on how the ordinal scale is defined. I would have prefered to treat it as an ordinal factor and perform an ANOVA.</p>
<p>The uncertainty in the self-reported exposure variable could maybe be mitigated somewhat by binning the values into ordinal categories. Then a chi-squared test could be performed (or ANOVA with skin-cell changes as continous).</p>
</section>
<section id="d-2" class="level3">
<h3 class="anchored" data-anchor-id="d-2">d)</h3>
<p>This is an observational study as no controlled experiment/intentional treatment was performed (that being the main difference).</p>
<p>The ethical limitations on purposefully exposing people to a potentially cancer inducing treatment make it impossible to perform an experimental version of this same study. However, it could be done using animal models. The benefit of an observational study is that it attempts to directly measure the real world circumstances and any conclusions are therefore easier to extrapolate to the rest of the population compared to other model systems.</p>
</section>
</section>
<section id="question-4" class="level2">
<h2 class="anchored" data-anchor-id="question-4">Question 4)</h2>
<section id="a-3" class="level3">
<h3 class="anchored" data-anchor-id="a-3">a)</h3>
<div class="cell" data-tbl-cap="Summary of data on 160 female fruit flies (*Drosophila melanogaster*) raised in different temperatures (20 vs 28 Celsius). Columns are means.">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Summary of data on 160 female fruit flies (<em>Drosophila melanogaster</em>) raised in different temperatures (20 vs 28 Celsius). Columns are means.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">temp</th>
<th style="text-align: right;">mass</th>
<th style="text-align: right;">metabolism</th>
<th style="text-align: right;">activity</th>
<th style="text-align: right;">longevity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">20</td>
<td style="text-align: right;">0.0049648</td>
<td style="text-align: right;">0.0061640</td>
<td style="text-align: right;">0.0061383</td>
<td style="text-align: right;">14.209053</td>
</tr>
<tr class="even">
<td style="text-align: left;">28</td>
<td style="text-align: right;">0.0054965</td>
<td style="text-align: right;">0.0085852</td>
<td style="text-align: right;">0.0056669</td>
<td style="text-align: right;">9.892801</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practice-exam-2024_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Distribution of data.</figcaption>
</figure>
</div>
</div>
</div>
<p>The variables mass and metabolism appear to be reasonably normaly distributed. While longevity is more questionable but not terrible, activity is heavily skewed. Applying a log<sub>10</sub> transformation to activity and longevity makes the distributions look better.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practice-exam-2024_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Distrubution of data. Activity and longevity log<sub>10</sub>transformed.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="b-3" class="level3">
<h3 class="anchored" data-anchor-id="b-3">b)</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2    PC3     PC4
Standard deviation     1.3599 1.0405 0.9297 0.45114
Proportion of Variance 0.4624 0.2707 0.2161 0.05088
Cumulative Proportion  0.4624 0.7330 0.9491 1.00000</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Standard deviations (1, .., p=4):
[1] 1.3599456 1.0405493 0.9296672 0.4511361

Rotation (n x k) = (4 x 4):
                  PC1        PC2        PC3          PC4
mass       -0.6362048  0.2306975 -0.3554492 -0.644730987
metabolism -0.6790526 -0.1562222 -0.1559050  0.700125616
activity    0.2924374 -0.4855833 -0.8237856 -0.008156896
longevity   0.2204802  0.8286025 -0.4131910  0.306723884</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>